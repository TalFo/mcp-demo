<!DOCTYPE html>
<html>
<head>
  <title>Vulnerable MCP Demo</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h2 { color: #d9534f; }
    textarea, input, button { width: 100%; font-size: 1em; margin-top: 5px; }
    pre { background: #eee; padding: 10px; }
    label { margin-top: 15px; display: block; font-weight: bold; }
    .container { max-width: 700px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    .info-box { background: #ffffcc; padding: 10px; border-left: 4px solid #ffcc00; margin-bottom: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ”“ Vulnerable MCP Demo</h2>
    <div class="info-box">
      <p><b>ğŸ” Logged-in user:</b> <code>dor@company.com</code> (readonly)</p>
      <p><b>ğŸ§¾ Role from MCP:</b> <span id="user-role-display">employee</span></p>
    </div>
    <p>This simulates a client sending <b>user-controlled metadata (MCP)</b> to an LLM API. You can escalate privileges by editing the MCP without changing the actual user identity.</p>

    <label for="prompt">Prompt:</label>
    <input type="text" id="prompt" value="What is my salary?">

    <label for="mcp">Edit MCP (ğŸš¨ you control this):</label>
    <textarea id="mcp" rows="8">{
  "user_role": "employee",
  "intent": "salary_inquiry",
  "application_id": "com.acme.hr"
}</textarea>

    <button onclick="submitPrompt()">Submit</button>

    <h3>ğŸ” Result:</h3>
    <pre id="result">Waiting for submission...</pre>
  </div>

  <script>
    function submitPrompt() {
      const prompt = document.getElementById("prompt").value;
      let mcp;
      try {
        mcp = JSON.parse(document.getElementById("mcp").value);
      } catch (e) {
        alert("Invalid MCP JSON");
        return;
      }

      // Show the forged role from MCP
      document.getElementById("user-role-display").innerText = mcp.user_role || "unknown";

      fetch("/ask_llm", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt, mcp })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("result").innerText = JSON.stringify(data, null, 2);
      });
    }
  </script>
</body>
</html>
